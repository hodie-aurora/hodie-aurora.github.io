---
layout:     post   				# 使用的布局（不需要改）
title:      traefik杂项笔记 			# 标题 
subtitle:   记录traefik相关的杂项概念		#副标题
date:       2025-01-13 				# 时间
author:     zhaohaiwen 				# 作者
header-img: img/post-bg-2025-01-13.jpg		#这篇文章标题背景图片
catalog: true 					# 是否归档
tags:						#标签
    - traefik相关
---
### 1、Traefik的自动服务发现与边缘路由器（kubernetes集群）

**边缘路由器**：管理集群出入口流量的组件称为边缘路由器。

**Traefik的自动服务发现**：Traefik自动发现的方法如下：

- 在Kubernetes集群里部署一个守护进程Traefik，此时它会监控所有的Service。
- 如果创建了一个Deployment，这个Deployment创建了一个Service。
- Traefik就会发现有一个新的Service出现，并且把这个新的Service纳入自己的管辖，热更改配置文件，使得自己的流量可以发送到这个新的Service。

**Ingress的自动发现**：Traefik同样会监听Ingress资源的变化，当新的Ingress被创建或现有的Ingress被更新时，Traefik会自动解析Ingress资源并更新其路由配置。这个过程包括：

- 监控Kubernetes集群中的Ingress资源。
- 解析Ingress资源中的注解和规则，确定如何将外部请求路由到具体的Service。
- 实时更新内部配置，使新的或变更的Ingress规则立即生效，确保流量能够正确路由到相应的Service。

### 2、Traefik的流量进出路径（kubernetes集群）

**流量入口**：

1. 客户端发起请求，该请求通过外部网络（例如互联网）进入Kubernetes集群。
2. 请求首先到达Traefik，Traefik充当边缘路由器，监听指定的入口点（EntryPoint）（如HTTP或HTTPS端口）。
3. Traefik根据Ingress资源中定义的路由规则，确定请求应该转发到哪个Service。
4. 请求通过Kubernetes Service转发到对应的Pod，Service负责将流量负载均衡分发到后端的Pod上。

**流量出口**：

1. Pod处理请求并生成响应。
2. 响应通过网络层直接返回给发起请求的Traefik实例，绕过Service，利用网络层的NAT机制（源地址转换）。
3. Traefik接收响应，并将其返回给外部客户端。

**流量路径总结**

**请求路径**：
客户端 → Traefik → Kubernetes Service → Pod

**响应路径**：
Pod → Traefik → 客户端

这种流量路径确保了请求和响应能够快速且高效地在客户端和后端服务之间传输，从而提高了系统的性能和可靠性。

### 4、k8s网关路由选择方案：

1. **Ingress**:

   - **功能弱**：默认 Kubernetes 自带的 Ingress 功能较少，但对于简单的路由需求已经足够。
   - **适用性强**：由于是 Kubernetes 原生支持，兼容性和适用性都非常好。
2. **HTTPRoute(Gateway)**:

   - **功能一般**：作为 Kubernetes Gateway API 的一部分，提供了更多的功能，但不如 IngressRoute 那么丰富。
   - **适应性一般**：需要安装 Kubernetes Gateway API 扩展，对于一些集群可能需要额外配置。
3. **IngressRoute(Traefik)**:

   - **功能强**：Traefik 的 CRD，提供了高级的路由和中间件功能，适合复杂的路由需求。
   - **适用性一般**：特定于 Traefik，因此在跨供应商环境中适用性可能不如标准 Kubernetes 资源。
4. **Istio 和其他 Service Mesh**:

   - **功能非常强**：Service Mesh（如 Istio）提供了完整的微服务管理能力，包括流量管理、安全、观察性等。
   - **适用性**：虽然功能强大，但复杂度和学习曲线较高，适合大型微服务架构。

### 5、k8s链路追踪和应用拓扑选择方案：?

#### 1. **Jaeger 全套方案**

- **Jaeger Client（发射器）**：
  - 在应用程序中生成追踪数据。
- **Jaeger Agent（中转站）**：
  - 接收追踪数据并转发给 Jaeger Collector。Jaeger Agent 的主要功能是收集 UDP 数据并批量发送给 Jaeger Collector。
- **Jaeger Collector（采集器）**：
  - 接收并处理追踪数据，存储到后端。Jaeger Collector 支持多种存储后端，包括 Elasticsearch、Cassandra 等。
- **Jaeger UI（UI）**：
  - 提供可视化界面查看和分析追踪数据。

#### 2.1 **OpenTelemetry 全套方案**

- **OpenTelemetry SDK（发射器）**：
  - 在应用程序中生成追踪数据、指标和日志。
- **OpenTelemetry Collector（中转站）**：
  - 接收、处理和导出追踪数据、指标和日志到 Jaeger Collector 或其他后端。OpenTelemetry Collector 可以将数据导出到多种后端，如 Jaeger、Prometheus、Elasticsearch 等。
- **Jaeger Collector（采集器）**：
  - 接收并处理来自 OpenTelemetry Collector 的追踪数据，存储到后端。
- **Jaeger UI（UI）**：
  - 提供可视化界面查看和分析追踪数据。

#### 2.2 **OpenTelemetry 全套方案（使用 SkyWalking）**

- **OpenTelemetry SDK（发射器）**：
  - 在应用程序中生成追踪数据、指标和日志。
- **OpenTelemetry Collector（中转站）**：
  - 接收、处理和导出追踪数据、指标和日志到 SkyWalking OAP 或其他后端。OpenTelemetry Collector 既可以接收、处理和导出追踪数据、指标和日志，还可以将数据导出到多种后端，如 SkyWalking、Prometheus、Elasticsearch 等。
- **SkyWalking OAP (Observability Analysis Platform)（采集器）**：
  - 负责接收并处理来自 OpenTelemetry Collector 的追踪数据、指标和日志，并存储到后端。SkyWalking OAP 具有模块化架构，能够独立扩展和部署。
- **SkyWalking UI（UI）**：
  - 提供可视化界面查看和分析追踪数据、指标和应用拓扑。

#### 3. **SkyWalking 全套方案**

- **SkyWalking Agent（发射器）**：
  - 安装在应用程序上，用于收集追踪和性能数据。
- **SkyWalking OAP (Observability Analysis Platform)（中转站/采集器）**：
  - 负责接收、处理和存储追踪和监控数据。因为 SkyWalking OAP 同时承担了中转站和采集器的角色，因此功能上是四层，但架构上常被描述为三层。SkyWalking OAP 是一个模块化平台，具备接收、处理和存储追踪、指标和日志数据的能力。它可以独立扩展和部署。
- **SkyWalking UI（UI）**：
  - 提供可视化界面查看和分析追踪数据和应用拓扑。
